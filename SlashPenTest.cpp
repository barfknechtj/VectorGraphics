//
//  SlashPenTest.cpp
//  Assignment2
//
//  Created by Jared Barfknecht on 9/16/17.
//  Copyright Â© 2017 Jared Barfknecht. All rights reserved.
//

#include <stdio.h>
#include "TestHarness.h"
#include "ICanvas.hpp"
#include "BasicCanvas.hpp"
#include "Color.hpp"
#include "IStroke.hpp"
#include "SlashStroke.hpp"
#include "IPen.hpp"
#include "SlashPen.hpp"
#include "WindowsBitmapEncoder.hpp"
#include "WindowsBitmapDecoder.hpp"

using namespace BitmapGraphics;

/* draw vertical stripe with slash stroke
   expected shape:
    -----
   |    *|
   |   * |
   |  *  |
   |     |
   |     |
    -----
*/

TEST(drawStripeOnCanvas, SquarePen)
{
    Color pixelToSet{255, 0, 0};
    
    SlashStroke stroke(3, pixelToSet);
    HPen hPen{new SlashPen(stroke)};
    
    Color backColor{255, 255, 255};
    HCanvas hCanvas{new BasicCanvas(5, 5, backColor)};
    
    /* attempt to draw 3 length slash starting at end of scanLine.
     Points outside canvas should be ignored */
    hPen->drawPoint(hCanvas, VG::Point(4, 0));
    
    HBitmapIterator canvasIterator = hCanvas->createBitmapIterator();
    
    WindowsBitmapEncoder encoderPrototype{};
    HBitmapEncoder encoder{encoderPrototype.clone(canvasIterator)};
    
    // Write out the bitmap
    std::ofstream outputStream{"3StripeOnCanvasPenDrawing.bmp", std::ios::binary};
    CHECK(outputStream.is_open());
    
    encoder->encodeToStream(outputStream);
    outputStream.close();
}
