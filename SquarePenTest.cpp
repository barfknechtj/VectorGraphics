//
//  SquarePenTest.cpp
//  Assignment2
//
//  Created by Jared Barfknecht on 9/12/17.
//  Copyright Â© 2017 Jared Barfknecht. All rights reserved.
//

#include <stdio.h>
#include "TestHarness.h"
#include "ICanvas.hpp"
#include "BasicCanvas.hpp"
#include "Color.hpp"
#include "IStroke.hpp"
#include "SquareStroke.hpp"
#include "IPen.hpp"
#include "SquarePen.hpp"
#include "WindowsBitmapEncoder.hpp"
#include "WindowsBitmapDecoder.hpp"

using namespace BitmapGraphics;

TEST(drawPoint, SquarePen)
{
    Color pixelToSet{255, 0, 0};
    
    SquareStroke stroke(1, pixelToSet);
    HPen hPen{new SquarePen(stroke)};
    
    Color backColor{255, 255, 255};
    HCanvas hCanvas{new BasicCanvas(10, 10, backColor)};
    
    /* drawing red point to first pixel within last row of Bitmap
       which is stored with bottom ScanLine first */
    hPen->drawPoint(hCanvas, VG::Point(0, 0));
    
    HBitmapIterator canvasIterator = hCanvas->createBitmapIterator();
    
    WindowsBitmapEncoder encoderPrototype{};
    HBitmapEncoder encoder{encoderPrototype.clone(canvasIterator)};
    
    // Write out the bitmap
    std::ofstream outputStream{"SquarePenDrawing.bmp", std::ios::binary};
    CHECK(outputStream.is_open());
    
    encoder->encodeToStream(outputStream);
    outputStream.close();
    
    // Read that one back in
    std::ifstream bitmapStream{"SquarePenDrawing.bmp", std::ios::binary};
    CHECK(bitmapStream.is_open());
    
    WindowsBitmapDecoder decoderPrototype{};
    HBitmapDecoder decoder{decoderPrototype.clone(bitmapStream)};
    auto bitmapIter = decoder->createIterator();
    
    // Confirm red pixel is first point
    CHECK_EQUAL(true, pixelToSet == bitmapIter->getColor());
}
